<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Run each CellProfiler step | Image-based Profiling Handbook</title>
  <meta name="description" content="This is a handbook for processing image-based profiling datasets using CellProfiler and pycytominer" />
  <meta name="generator" content="bookdown 0.22.5 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Run each CellProfiler step | Image-based Profiling Handbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a handbook for processing image-based profiling datasets using CellProfiler and pycytominer" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Run each CellProfiler step | Image-based Profiling Handbook" />
  
  <meta name="twitter:description" content="This is a handbook for processing image-based profiling datasets using CellProfiler and pycytominer" />
  

<meta name="author" content="Beth Cimini, Tim Becker, Shantanu Singh, Gregory Way, Hamdah Abbasi" />


<meta name="date" content="2021-06-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="setup-images.html"/>
<link rel="next" href="create-profiles.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Image-based Profiling Handbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#collect-your-software"><i class="fa fa-check"></i><b>1.1</b> Collect your software</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#collect-your-pipelines"><i class="fa fa-check"></i><b>1.2</b> Collect your pipelines</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#determine-how-to-get-your-image-lists-to-cellprofiler"><i class="fa fa-check"></i><b>1.3</b> Determine how to get your image lists to CellProfiler</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#execute-your-cellprofiler-pipelines"><i class="fa fa-check"></i><b>1.4</b> Execute your CellProfiler pipelines</a><ul>
<li class="chapter" data-level="1.4.1" data-path="introduction.html"><a href="introduction.html#optional-z-projection"><i class="fa fa-check"></i><b>1.4.1</b> (Optional) Z projection</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction.html"><a href="introduction.html#optional-qc"><i class="fa fa-check"></i><b>1.4.2</b> (Optional) QC</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction.html"><a href="introduction.html#illumination-correction"><i class="fa fa-check"></i><b>1.4.3</b> Illumination correction</a></li>
<li class="chapter" data-level="1.4.4" data-path="introduction.html"><a href="introduction.html#optional-assay-development"><i class="fa fa-check"></i><b>1.4.4</b> (Optional) Assay Development</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#analysis"><i class="fa fa-check"></i><b>1.5</b> Analysis</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#aggregate-your-data"><i class="fa fa-check"></i><b>1.6</b> Aggregate your data</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#create-and-manipulate-per-well-profiles."><i class="fa fa-check"></i><b>1.7</b> Create and manipulate per-well profiles.</a></li>
</ul></li>
<li class="part"><span><b>I Configuration</b></span></li>
<li class="chapter" data-level="2" data-path="configure-environment-for-full-profiling-pipeline.html"><a href="configure-environment-for-full-profiling-pipeline.html"><i class="fa fa-check"></i><b>2</b> Configure Environment for Full Profiling Pipeline</a><ul>
<li class="chapter" data-level="2.1" data-path="configure-environment-for-full-profiling-pipeline.html"><a href="configure-environment-for-full-profiling-pipeline.html#launch-an-aws-virtual-machine-for-making-csvs-and-running-distributed-cellprofiler"><i class="fa fa-check"></i><b>2.1</b> Launch an AWS Virtual Machine for making CSVs and running Distributed-CellProfiler</a></li>
<li class="chapter" data-level="2.2" data-path="configure-environment-for-full-profiling-pipeline.html"><a href="configure-environment-for-full-profiling-pipeline.html#create-a-tmux-session"><i class="fa fa-check"></i><b>2.2</b> Create a tmux session</a></li>
<li class="chapter" data-level="2.3" data-path="configure-environment-for-full-profiling-pipeline.html"><a href="configure-environment-for-full-profiling-pipeline.html#define-environment-variables"><i class="fa fa-check"></i><b>2.3</b> Define Environment Variables</a></li>
<li class="chapter" data-level="2.4" data-path="configure-environment-for-full-profiling-pipeline.html"><a href="configure-environment-for-full-profiling-pipeline.html#create-directories"><i class="fa fa-check"></i><b>2.4</b> Create Directories</a></li>
<li class="chapter" data-level="2.5" data-path="configure-environment-for-full-profiling-pipeline.html"><a href="configure-environment-for-full-profiling-pipeline.html#download-software"><i class="fa fa-check"></i><b>2.5</b> Download Software</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="setup-images.html"><a href="setup-images.html"><i class="fa fa-check"></i><b>3</b> Setup Images</a><ul>
<li class="chapter" data-level="3.1" data-path="setup-images.html"><a href="setup-images.html#upload-images"><i class="fa fa-check"></i><b>3.1</b> Upload Images</a></li>
<li class="chapter" data-level="3.2" data-path="setup-images.html"><a href="setup-images.html#prepare-images"><i class="fa fa-check"></i><b>3.2</b> Prepare Images</a></li>
<li class="chapter" data-level="3.3" data-path="setup-images.html"><a href="setup-images.html#create-list-of-plates"><i class="fa fa-check"></i><b>3.3</b> Create List of Plates</a></li>
<li class="chapter" data-level="3.4" data-path="setup-images.html"><a href="setup-images.html#create-loaddata-csvs"><i class="fa fa-check"></i><b>3.4</b> Create LoadData CSVs</a></li>
<li class="chapter" data-level="3.5" data-path="setup-images.html"><a href="setup-images.html#upload-image-location-files-to-s3"><i class="fa fa-check"></i><b>3.5</b> Upload image location files to S3</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html"><i class="fa fa-check"></i><b>4</b> Run each CellProfiler step</a><ul>
<li class="chapter" data-level="4.1" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#upload-your-pipelines-to-s3"><i class="fa fa-check"></i><b>4.1</b> Upload your pipelines to S3</a></li>
<li class="chapter" data-level="4.2" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#configure-distributed-cellprofilers-run_batch_general-script"><i class="fa fa-check"></i><b>4.2</b> Configure Distributed-CellProfiler's <code>run_batch_general</code> script</a></li>
<li class="chapter" data-level="4.3" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#configure-distributed-cellprofilers-fleet-file"><i class="fa fa-check"></i><b>4.3</b> Configure Distributed-CellProfiler's fleet file</a></li>
<li class="chapter" data-level="4.4" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#change-required-parameters-in-distributed-cellprofilers-config-file"><i class="fa fa-check"></i><b>4.4</b> Change required parameters in Distributed-CellProfiler's config file</a></li>
<li class="chapter" data-level="4.5" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#run-each-cellprofiler-step-1"><i class="fa fa-check"></i><b>4.5</b> Run each CellProfiler step</a><ul>
<li class="chapter" data-level="4.5.1" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#optional-z-projection-1"><i class="fa fa-check"></i><b>4.5.1</b> (Optional) Z projection</a></li>
<li class="chapter" data-level="4.5.2" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#optional-qc-1"><i class="fa fa-check"></i><b>4.5.2</b> (Optional) QC</a></li>
<li class="chapter" data-level="4.5.3" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#illumination-correction-1"><i class="fa fa-check"></i><b>4.5.3</b> Illumination Correction</a></li>
<li class="chapter" data-level="4.5.4" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#optional-assay-dev"><i class="fa fa-check"></i><b>4.5.4</b> (Optional) Assay Dev</a></li>
<li class="chapter" data-level="4.5.5" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#analysis-1"><i class="fa fa-check"></i><b>4.5.5</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="run-each-cellprofiler-step.html"><a href="run-each-cellprofiler-step.html#optional-do-any-post-cellprofiler-steps"><i class="fa fa-check"></i><b>4.6</b> (Optional) Do any post-CellProfiler steps</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="create-profiles.html"><a href="create-profiles.html"><i class="fa fa-check"></i><b>5</b> Create Profiles</a><ul>
<li class="chapter" data-level="5.1" data-path="create-profiles.html"><a href="create-profiles.html#confirm-environment-configuration"><i class="fa fa-check"></i><b>5.1</b> Confirm Environment Configuration</a></li>
<li class="chapter" data-level="5.2" data-path="create-profiles.html"><a href="create-profiles.html#add-a-large-ebs-volume-to-your-machine"><i class="fa fa-check"></i><b>5.2</b> Add a large EBS volume to your machine</a></li>
<li class="chapter" data-level="5.3" data-path="create-profiles.html"><a href="create-profiles.html#create-database-backend"><i class="fa fa-check"></i><b>5.3</b> Create Database Backend</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a><ul>
<li class="chapter" data-level="A.1" data-path="appendix-a.html"><a href="appendix-a.html#project-folder-structure-guidance"><i class="fa fa-check"></i><b>A.1</b> Project folder structure guidance</a></li>
<li class="chapter" data-level="A.2" data-path="appendix-a.html"><a href="appendix-a.html#directory-structure"><i class="fa fa-check"></i><b>A.2</b> Directory structure</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Image-based Profiling Handbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="run-each-cellprofiler-step" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Run each CellProfiler step</h1>
<p>The steps below are outlined specifically for running Distributed CellProfiler on AWS.<br />
If you are not doing so, the steps will still be more-or-less the same</p>
<ul>
<li>Make sure CellProfiler pipelines are accessible</li>
<li>Make sure CellProfiler knows where the input images are, either via a CSV or a batch file</li>
<li>Run each CellProfiler pipeline, in sequence, with appropriate input folder, output folder, and grouping</li>
</ul>
<div id="upload-your-pipelines-to-s3" class="section level2">
<h2><span class="header-section-number">4.1</span> Upload your pipelines to S3</h2>
<p>In your project's workspace directory, create a batch specific folder and upload your pipelines there.<br />
If there are previous batches from the same project or a similar one, you may find it easiest to copy the files directly. Once uploaded and/or copied, the file structure should look like the below.</p>
<pre><code>└── pipelines
    └── 2016_04_01_a549_48hr_batch1
        ├── illum_without_batchfile.cppipe
        └── analysis_without_batchfile.cppipe</code></pre>
</div>
<div id="configure-distributed-cellprofilers-run_batch_general-script" class="section level2">
<h2><span class="header-section-number">4.2</span> Configure Distributed-CellProfiler's <code>run_batch_general</code> script</h2>

<div class="rmdnote">
Note that <a href="https://github.com/CellProfiler/Distributed-CellProfiler/blob/master/run_batch_general.py"><code>run_batch_general</code></a> is not required; the Distributed CellProfiler <a href="https://github.com/CellProfiler/Distributed-CellProfiler/wiki/Step-2%3A-Submit-jobs">handbook</a> lays out a number of different ways of creating jobs.<br />
However, we find it the most efficient way to run numerous pipelines on the same data. If you do not wish to use it, you can adjust steps 3 and 4 in the &quot;Run each CellProfiler step&quot; to &quot;Create a job file&quot; and &quot;Execute <code>python3 run.py submitJob jobFileName.json</code>&quot;
</div>

<p><code>run_batch_general.py</code> can be configured once at the beginning of the run of a batch of data, and then can be run for each step simply by uncommenting the name of the step to run.<br />
The following variables in the <code>project specific stuff</code> section of the script should be configured:</p>
<ul>
<li><code>topdirname</code> and <code>batchsuffix</code> should match your <code>PROJECT_NAME</code> and <code>BATCH_ID</code>, respectively</li>
<li><code>appname</code> is typically the same as <code>topdirname</code>, but if that name is long and cumbersome you can create an abbreviated version here (ie <code>2015_10_05_DrugRepurposing</code> rather than <code>2015_10_05_DrugRepurposing_AravindSubramanian_GolubLab_Broad</code>). This will be used in your <code>config.py</code> file</li>
<li><code>rows</code>, <code>columns</code>, and <code>sites</code> should reflect the imaging conditions used</li>
<li><code>platelist</code> should contain a list of plates, comma separated, ie <code>['SQ00015167','SQ00015168']</code></li>
<li>If you are using pipeline files with the LoadData module and CSVs, you should make sure that the pipeline names reflect your pipeline names (or adjust if not). Otherwise, you should make sure that the batch file names reflect your batch file names.</li>
<li>If following the recommended structures and procedures, none of the <code>not project specific</code> section of the script should need to be adapted, but if you are making changes you may need to.</li>
</ul>
</div>
<div id="configure-distributed-cellprofilers-fleet-file" class="section level2">
<h2><span class="header-section-number">4.3</span> Configure Distributed-CellProfiler's fleet file</h2>
<p>If running in a fresh clone of Distributed-CellProfiler, you will need to configure a single fleet file, which will be used in all subsequent steps.<br />
Refer to the <a href="https://github.com/CellProfiler/Distributed-CellProfiler/wiki/Step-3%3A-Start-your-cluster">manual</a> for instructions.</p>
</div>
<div id="change-required-parameters-in-distributed-cellprofilers-config-file" class="section level2">
<h2><span class="header-section-number">4.4</span> Change required parameters in Distributed-CellProfiler's config file</h2>
<p>If running in a fresh clone of Distributed-CellProfiler, you will need to set the <code>AWS_REGION</code>, <code>SSH_KEY_NAME</code>, <code>AWS_BUCKET</code>, and <code>SQS_DEAD_LETTER_QUEUE</code> settings to appropriate settings for your account. Refer to the <a href="https://github.com/CellProfiler/Distributed-CellProfiler/wiki/Step-1%3A--Configuration">manual</a> for instructions.</p>
</div>
<div id="run-each-cellprofiler-step-1" class="section level2">
<h2><span class="header-section-number">4.5</span> Run each CellProfiler step</h2>
<p>You may have as many as 5 or as few as 2 CellProfiler steps</p>
<ul>
<li>(optional) Z projection</li>
<li>(optional) QC - see also section 4.6</li>
<li>illumination correction</li>
<li>(optional) assay development - see also section 4.6</li>
<li>analysis.</li>
</ul>
<p>For each step, the steps you will run will be identical:</p>
<ol style="list-style-type: decimal">
<li>Configure the <code>config.py</code> file</li>
<li>Execute <code>python3 run.py setup</code></li>
<li>Uncomment the correct step name in your <code>run_batch_general.py</code> file (and ensure all other steps are commented out)</li>
<li>Execute <code>python3 run_batch_general.py</code></li>
<li>Execute <code>python3 run.py startCluster files/yourFleetFileName.json</code>, where you have set the name of the fleet file previously created or located</li>
<li>Execute <code>python3 run.py monitor files/APP_NAMESpotFleetRequestId.json</code>, where APP_NAME matches the APP_NAME variable set in step 1.</li>
</ol>
<p>Information on all of these steps is available in the <a href="https://github.com/CellProfiler/Distributed-CellProfiler/wiki">Distributed-CellProfiler wiki</a>. You need only absolutely change the variables stated above and below for Distributed-CellProfiler to function, but other variables may be useful, such as using a non-default profile, adjusting whether or not you would like to pre-download files and/or use plugins and/or restart only parts of a batch of data.</p>
<p>In general, as long as you are running inside a tmux session and it isn't killed, the monitor should destroy any and all infrastructure created on AWS as part of the running Distributed-CellProfiler, but it is the user's responsibility to check that this has completed appropriately; failure to do so may lead to spot fleets generating charges after all useful work has completed.</p>
<div id="optional-z-projection-1" class="section level3">
<h3><span class="header-section-number">4.5.1</span> (Optional) Z projection</h3>
<ul>
<li>Your <code>APP_NAME</code> variable should be set to the <code>appname</code> set in <code>run_batch_general.py</code> plus <code>_Zproj</code>, ie <code>2015_10_05_DrugRepurposing_Zproj</code></li>
<li>Your number of <code>CLUSTER_MACHINES</code> should be medium-large, ie a hundred or few hundred.</li>
<li>Your <code>SQS_MESSAGE_VISIBILITY</code> should be short, such as <code>5*60</code> (5 minutes)</li>
</ul>
</div>
<div id="optional-qc-1" class="section level3">
<h3><span class="header-section-number">4.5.2</span> (Optional) QC</h3>
<ul>
<li>Your <code>APP_NAME</code> variable should be set to the <code>appname</code> set in <code>run_batch_general.py</code> plus <code>_QC</code>, ie <code>2015_10_05_DrugRepurposing_QC</code></li>
<li>Your number of <code>CLUSTER_MACHINES</code> should be medium-large, ie a hundred or few hundred.</li>
<li>Your <code>SQS_MESSAGE_VISIBILITY</code> should be short, such as <code>5*60</code> (5 minutes)</li>
</ul>
</div>
<div id="illumination-correction-1" class="section level3">
<h3><span class="header-section-number">4.5.3</span> Illumination Correction</h3>
<ul>
<li>Your <code>APP_NAME</code> variable should be set to the <code>appname</code> set in <code>run_batch_general.py</code> plus <code>_Illum</code>, ie <code>2015_10_05_DrugRepurposing_Illum</code></li>
<li>Your number of <code>CLUSTER_MACHINES</code> should be set to the number of plates you have divided by 4 then rounded up, ie 6 for 22 plates</li>
<li>Your <code>SQS_MESSAGE_VISIBILITY</code> should be 12 hours <code>720*60</code></li>
</ul>
</div>
<div id="optional-assay-dev" class="section level3">
<h3><span class="header-section-number">4.5.4</span> (Optional) Assay Dev</h3>
<ul>
<li>Your <code>APP_NAME</code> variable should be set to the <code>appname</code> set in <code>run_batch_general.py</code> plus <code>_AssayDev</code>, ie <code>2015_10_05_DrugRepurposing_AssayDev</code></li>
<li>Your number of <code>CLUSTER_MACHINES</code> should be medium-large, ie a hundred or few hundred.</li>
<li>Your <code>SQS_MESSAGE_VISIBILITY</code> should be short, such as <code>5*60</code> (5 minutes)</li>
</ul>
</div>
<div id="analysis-1" class="section level3">
<h3><span class="header-section-number">4.5.5</span> Analysis</h3>
<ul>
<li>Your <code>APP_NAME</code> variable should be set to the <code>appname</code> set in <code>run_batch_general.py</code> plus <code>_Analysis</code>, ie <code>2015_10_05_DrugRepurposing_Analysis</code></li>
<li>Your number of <code>CLUSTER_MACHINES</code> should be as many as possible per your account limits, ideally at least a few hundred.</li>
<li>Your <code>SQS_MESSAGE_VISIBILITY</code> should be 10-20 minutes for images with a binning of 2, longer (30-120 minutes) for unbinned images and/or CellProfiler 2 or 3 runs. This value is the most potentially variable -once you've run a single analysis workflow, you can adjust this value accordingly based on your log files.</li>
</ul>
</div>
</div>
<div id="optional-do-any-post-cellprofiler-steps" class="section level2">
<h2><span class="header-section-number">4.6</span> (Optional) Do any post-CellProfiler steps</h2>
<p>The optional QC and assay development steps have post-CellProfiler components.<br />
These pipelines need only be run if the user plans to do these post-CellProfiler steps.</p>
<ul>
<li>QC may require visual inspection of images, <a href="https://github.com/CellProfiler/tutorials/tree/master/QualityControl">creation of a machine learning classifier to detect poor quality images</a>, and/or running scripts to evaluate CV. How best to evaluate quality is left to the user.</li>
<li>The assay development step creates images to be visually evaluated, either individually or <a href="https://currentprotocols.onlinelibrary.wiley.com/doi/full/10.1002/cpz1.89">after stitching for easier evaluation</a>. If your segmentation is not ideal, you may need to update your assay dev and analysis pipelines by manually tuning the segmentation steps on a local set of representative data until they perform better on your images, then making sure to update the segmentation in the assay dev and analysis pipelines on your cluster accordingly.</li>
<li>After running the final analysis pipelines, proceed to the next step of this guide.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="setup-images.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="create-profiles.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cytomining/profiling-handbook/edit/master/04-run-cellprofiler.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
